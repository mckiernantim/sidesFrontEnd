<div class="container mx-auto px-4 py-8 max-w-4xl">
  <!-- Loading spinner -->
  <div *ngIf="isLoading" class="flex justify-center items-center min-h-[400px]">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div>
  </div>
  
  <!-- Error message -->
  <div *ngIf="error" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 text-center">
    <h3 class="font-bold text-lg mb-2">Error</h3>
    <p>{{ error }}</p>
    <div class="mt-4">
      <button 
        (click)="loadSubscriptionData()" 
        class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
      >
        Try Again
      </button>
    </div>
  </div>
  
  <!-- Not logged in state -->
  <div *ngIf="!isLoading && !user" class="bg-white rounded-lg shadow-md p-8 text-center">
    <h1 class="text-2xl font-bold mb-6">Sign In to View Your Profile</h1>
    <p class="mb-8 text-gray-600">You need to be signed in to view your profile and manage your subscription.</p>
    <button 
      (click)="signIn()" 
      class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-md transition-colors"
    >
      Sign in with Google
    </button>
  </div>
  
  <!-- Profile content (logged in) -->
  <div *ngIf="!isLoading && user && !error" class="bg-white rounded-lg shadow-md p-8 mx-auto max-w-3xl">
    <h1 class="text-2xl font-bold mb-8 text-center">Your Profile</h1>
    
    <!-- Subscription Section -->
    <div class="mb-10">
      <h2 class="text-xl font-semibold mb-6 pb-2 border-b border-gray-200">Subscription</h2>
      
      <!-- Active subscription that will renew -->
      <div *ngIf="isSubscriptionActive() && subscription?.subscription?.willAutoRenew" class="p-6 bg-green-50 rounded-lg border border-green-100 mb-4">
        <div class="flex flex-col">
          <div class="text-green-800 font-medium mb-2">Your subscription is active</div>
          
          <!-- Subscription details -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm text-green-700">
            <div>
              <p class="font-medium">Member since</p>
              <p>{{ formatDate(subscription?.subscription?.originalStartDate) }}</p>
            </div>
            <div>
              <p class="font-medium">Current period ends</p>
              <p>{{ formatDate(subscription?.subscription?.currentPeriodEnd) }}</p>
            </div>
            <div>
              <p class="font-medium">Documents processed</p>
              <p>{{ subscription?.usage?.pdfsGenerated || 0 }}</p>
            </div>
            <div *ngIf="subscription?.plan">
              <p class="font-medium">Billing</p>
              <p>{{ formatCurrency(subscription?.plan?.amount) }} per {{ subscription?.plan?.interval }}</p>
            </div>
          </div>
          
          <div class="flex justify-end">
            <button 
              (click)="manageSubscription()" 
              class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Manage Subscription
            </button>
          </div>
        </div>
      </div>
      
      <!-- Active subscription that will be canceled -->
      <div *ngIf="isSubscriptionCanceling()" class="p-6 bg-orange-50 rounded-lg border border-orange-100 mb-4">
        <div class="flex flex-col">
          <div class="text-orange-800 font-medium mb-2">
            Your subscription is {{ subscription?.subscription?.status === 'active' ? 'active' : 'canceled' }} but will not renew
          </div>
          
          <!-- Subscription details -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm text-orange-700">
            <div>
              <p class="font-medium">Member since</p>
              <p>{{ formatDate(subscription?.subscription?.originalStartDate) }}</p>
            </div>
            <div>
              <p class="font-medium">Access until</p>
              <p>{{ formatDate(subscription?.subscription?.currentPeriodEnd) }}</p>
            </div>
            <div>
              <p class="font-medium">Documents processed</p>
              <p>{{ subscription?.usage?.pdfsGenerated || 0 }}</p>
            </div>
            <div *ngIf="subscription?.plan">
              <p class="font-medium">Billing</p>
              <p>{{ formatCurrency(subscription?.plan?.amount) }} per {{ subscription?.plan?.interval }}</p>
            </div>
          </div>
          
          <div class="flex justify-between mt-2">
            <button 
              (click)="handleNewSubscription()" 
              class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Renew Subscription
            </button>
            
            <button 
              (click)="manageSubscription()" 
              class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Manage Subscription
            </button>
          </div>
        </div>
      </div>
      
      <!-- Canceled subscription -->
      <div *ngIf="!isSubscriptionActive() && subscription?.subscription?.status === 'canceled'" class="p-6 bg-yellow-50 rounded-lg border border-yellow-100 mb-4">
        <div class="flex flex-col">
          <div class="text-yellow-800 font-medium mb-2">Your subscription has been canceled</div>
          
          <div class="text-sm text-yellow-700 mb-4">
            <div *ngIf="subscription?.subscription?.originalStartDate">
              Your subscription started on {{ formatDate(subscription?.subscription?.originalStartDate) }}
            </div>
            <div *ngIf="subscription?.subscription?.currentPeriodEnd">
              and ended on {{ formatDate(subscription?.subscription?.currentPeriodEnd) }}
            </div>
          </div>
          
          <div class="flex justify-end">
            <button 
              (click)="handleNewSubscription()" 
              class="bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Restart Subscription
            </button>
          </div>
        </div>
      </div>
      
      <!-- No subscription yet or pending subscription -->
      <div *ngIf="!isSubscriptionActive() && subscription?.subscription?.status !== 'canceled'" class="p-6 bg-blue-50 rounded-lg border border-blue-100">
        <h3 class="text-xl font-semibold mb-4 text-blue-800">Upgrade to Premium</h3>
        
        <!-- Show pending message if status is pending -->
        <div *ngIf="subscription?.subscription?.status === 'pending'" class="mb-4 p-3 bg-yellow-50 border border-yellow-100 rounded text-yellow-800">
          <p>Your subscription is currently being processed. This may take a few moments.</p>
          <p class="mt-2 text-sm">If this status persists for more than a few minutes, please refresh the page or contact support.</p>
          
          <div class="mt-4 flex justify-between">
            <button 
              (click)="refreshSubscriptionStatus()" 
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Refresh Status
            </button>
            
            <button 
              (click)="manageSubscription()" 
              class="bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Manage Subscription
            </button>
          </div>
        </div>
        
        <!-- Benefits list -->
        <div class="mb-6">
          <h4 class="font-medium text-blue-800 mb-2">Premium Benefits:</h4>
          <ul class="list-disc pl-5 space-y-1 text-blue-700">
            <li *ngFor="let benefit of benefits">{{ benefit }}</li>
          </ul>
        </div>
        
        <div class="flex justify-between items-center">
          <p class="text-xl font-bold text-blue-800">$20 per week</p>
          <button 
            (click)="handleNewSubscription()" 
            [disabled]="subscription?.subscription?.status === 'pending'"
            [ngClass]="{'opacity-50 cursor-not-allowed': subscription?.subscription?.status === 'pending'}"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md transition-colors"
          >
            {{ subscription?.subscription?.status === 'pending' ? 'Processing...' : 'Subscribe Now' }}
          </button>
        </div>
      </div>
    </div>
    
    <!-- Account Settings Section -->
    <div class="mt-10">
      <h2 class="text-xl font-semibold mb-6 pb-2 border-b border-gray-200">Account Settings</h2>
      <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
        <div *ngIf="user" class="mb-6">
          <p class="text-sm text-gray-600 mb-1">Email</p>
          <p class="font-medium text-lg">{{ user.email }}</p>
        </div>
        
        <div class="mt-6 pt-4 border-t border-gray-200">
          <button 
            (click)="logout()"
            class="border border-red-600 text-red-600 hover:bg-red-50 font-medium py-2 px-4 rounded-md transition-colors"
          >
            Sign Out
          </button>
        </div>
      </div>
    </div>
  </div>
</div>